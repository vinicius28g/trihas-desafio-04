<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Relatório Educacional - Maranhão</title>

  <script src="https://code.highcharts.com/highcharts.js"></script>
  <script src="https://code.highcharts.com/modules/exporting.js"></script>
  <script src="https://code.highcharts.com/modules/export-data.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/kelvins/Estados-Cidades-IBGE/estados-cidades.js"></script>
  <script src="../script.js"></script>
  <script src="https://unpkg.com/cash-dom/dist/cash.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />

  <style>
    body { background-color: #f9fafb; color: #1f2937; font-family: Arial, sans-serif; }
    .card {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
      padding: 16px;
      margin-bottom: 16px;
    }
    h1,h2,h3 { margin-bottom: 8px; }
    /* Ajuste para os containers dos gráficos */
    #idebChart, #enemMaChart, #inseChart {
      width: 100%;
      height: 400px;
    }
  </style>
</head>
<body x-data="{ estado: 'MA', rede: 'todas' }">

  <div class="container mx-auto p-6 max-w-5xl">

    <h1 class="text-3xl font-bold mb-6">Relatório Educacional - Maranhão</h1>

    <!-- Filtros -->
  <select id="estado">
  <option value="">Selecione um estado</option>
</select>

<select id="cidade">
  <option value="">Selecione uma cidade</option>
</select>

      <select x-model="rede" class="border rounded px-3 py-2">
        <option value="todas">Todas</option>
        <option value="publica">Pública</option>
        <option value="privada">Privada</option>
      </select>

      <button class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" @click="atualizarGraficos()">
        Pesquisar
      </button>
    </div>

    <!-- IDEB -->
    <div class="card">
      <h2 class="text-xl font-semibold">Nota do IDEB nos últimos 5 anos</h2>
      <div id="idebChart"></div>
    </div>

    <!-- ENEM Maranhão -->
    <div class="card">
      <h2 class="text-xl font-semibold mb-4">Notas do ENEM</h2>
      <div></div>
      <div id="enemMaChart"></div>
    </div>
    <div class="card">
      <h2 class="text-xl font-semibold mb-4"> Médias do ENEM no Brasil</h2>
      <div id="mapa brasil" style="width: 800px; height: 600px; margin: 0 auto"></div>
    </div>
     
    <!-- INSE -->
    <div class="card">
      <h2 class="text-xl font-semibold">Distribuição de Escolas por Nível INSE</h2>
      <div id="inseChart"></div>
    </div>

    <!-- Infraestrutura -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mt-8">
      <div class="card">
        <h3 class="font-semibold">Biblioteca</h3>
        <p>Quantidade: 800</p>
      </div>
      <div class="card">
        <h3 class="font-semibold">Água Filtrada</h3>
        <p>Quantidade: 200</p>
      </div>
      <div class="card">
        <h3 class="font-semibold">Sala de Atendimento Especial</h3>
        <p>Quantidade: 240</p>
      </div>
      <div class="card">
        <h3 class="font-semibold">Internet</h3>
        <p>Quantidade: 500</p>
      </div>
      <div class="card">
        <h3 class="font-semibold">Banda Larga</h3>
        <p>Quantidade: 200</p>
      </div>
      <div class="card">
        <h3 class="font-semibold">Acessibilidade</h3>
        <p>Quantidade: 400</p>
      </div>
    </div>

  </div>



<script>
  const estadoSelect = document.getElementById('estado');
const cidadeSelect = document.getElementById('cidade');

// Carrega os estados do Brasil
fetch('https://servicodados.ibge.gov.br/api/v1/localidades/estados?orderBy=nome')
  .then(res => res.json())
  .then(estados => {
    let maranhaoId = null;

    estados.forEach(estado => {
      const opt = document.createElement('option');
      opt.value = estado.id;
      opt.textContent = estado.nome;

      if (estado.sigla === 'MA') {
        opt.selected = true; 
        maranhaoId = estado.id;
      }

      estadoSelect.appendChild(opt);
    });

   
    if (maranhaoId) {
      carregarCidades(maranhaoId);
    }
  });


function carregarCidades(estadoId) {
  cidadeSelect.innerHTML = '<option value="">Carregando...</option>';

  fetch(`https://servicodados.ibge.gov.br/api/v1/localidades/estados/${estadoId}/municipios`)
    .then(res => res.json())
    .then(cidades => {
      cidadeSelect.innerHTML = '<option value="">Selecione uma cidade</option>';
      cidades.forEach(cidade => {
        const opt = document.createElement('option');
        opt.value = cidade.id;
        opt.textContent = cidade.nome;
        cidadeSelect.appendChild(opt);
      });
    });
}

// Quando um estado for selecionado, carrega as cidades
estadoSelect.addEventListener('change', () => {
  const estadoId = estadoSelect.value;
  if (estadoId) {
    carregarCidades(estadoId);
  }
});

  let idebChart, enemMaChart, inseChart;

document.getElementById('estado').addEventListener('change', async () => {
  const estadoId = document.getElementById('estado').value;
  if (estadoId) {
    await atualizarGraficos(estadoId);
  }
});

document.getElementById('cidade').addEventListener('change', async () => {
  const cidadeId = document.getElementById('cidade').value;
  if (cidadeId) {
    await atualizarGraficos();
  }
});

async function atualizarGraficos() {
  const dados = await dadosIdeb(); // Aqui você pode usar o estado para filtrar os dados

  const seriesIdeb = {
    title: 'Nota do IDEB nos últimos 5 anos',
    categories: dados.categorias,
    series: [
      {
        name: 'IDEB Obtido',
        data: dados.idebObtido,
        color: 'green',
      },
      {
        name: 'IDEB Esperada',
        data: dados.idebEsperado,
        dashStyle: 'Dash',
        color: 'gray',
      }
    ]
  };

  const dadosEnemMA = {
    categories: ['Linguagens', 'Matemática', 'Ciências Humanas', 'Ciências da Natureza', 'Redação'],
    series: [{
      name: 'Média MA',
      data: [480, 470, 460, 455, 500],
      color: '#2563eb'
    }]
  };

  const dadosInse = {
    categories: ['Nível 1', 'Nível 2', 'Nível 3', 'Nível 4', 'Nível 5', 'Nível 6', 'Nível 7', 'Nível 8'],
    series: [{
      name: 'Quantidade de Escolas',
      data: [1200, 1000, 800, 600, 400, 200, 100, 50],
      color: '#14b8a6'
    }]
  };

  criarGraficoIdeb(seriesIdeb);
  criarGraficoEnem(dadosEnemMA);
  criarGraficoInse(dadosInse);
}

function criarGraficoIdeb(dados) {
  if (idebChart) idebChart.destroy();

  idebChart = Highcharts.chart('idebChart', {
    chart: { type: 'line' },
    title: { text: '' },
    xAxis: { categories: dados.categories },
    yAxis: {
      min: 0,
      max: 10,
      title: { text: 'Nota' }
    },
    tooltip: { shared: true },
    series: dados.series,
    credits: { enabled: false }
  });
}

function criarGraficoEnem(dados) {
  if (enemMaChart) enemMaChart.destroy();

  enemMaChart = Highcharts.chart('enemMaChart', {
    chart: { type: 'column' },
    title: { text: '' },
    xAxis: { categories: dados.categories, crosshair: true },
    yAxis: {
      min: 0,
      max: 10,
      title: { text: 'Pontos' }
    },
    tooltip: { shared: true },
    series: dados.series,
    credits: { enabled: false }
  });
}

function criarGraficoInse(dados) {
  if (inseChart) inseChart.destroy();

  inseChart = Highcharts.chart('inseChart', {
    chart: { type: 'column' },
    title: { text: '' },
    xAxis: { categories: dados.categories, crosshair: true },
    yAxis: {
      min: 0,
      title: { text: 'Quantidade de Escolas' }
    },
    tooltip: { shared: true },
    series: dados.series,
    credits: { enabled: false }
  });
}

window.onload = async () => {
  const estadoId = document.getElementById('estado').value;
  if (estadoId) {
    await atualizarGraficos(estadoId);
  }
};
</script>


<script>
    // Dados de exemplo: cada objeto tem o código do estado e a média do indicador
    // O código dos estados no mapa highcharts usa a sigla em minúsculo (ex: 'br-sp' para São Paulo)
    
  </script>

</body>
</html>
